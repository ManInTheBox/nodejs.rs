article.post.single
  .main-content
    != messages()
    h3
      a(href='/post/#{post.titleUrl}')= post.title
    p.post-info Napisao 
      a(href='/user/#{post.owner.name.username}')= post.owner.name.full || post.owner.name.username
      | , dana #{post.createdAtFormatted}
      span(style='float: right;')
        a(href='/post/#{post.titleUrl}/download', id='download') Preuzmi
        br
        span.download-box(style='display: none; float: right; background: #F3F4F5; border: 1px solid #E4E6E9; padding: 0 5px;')
          a(href='/post/#{post.titleUrl}/download') Kao HTML format 
          br
          a(href='/post/#{post.titleUrl}.md/download') Kao Mark down format
          br
          a(href='/post/#{post.titleUrl}.pdf/download') Kao PDF format
      - if (canEditPost)
        a(href='/post/#{post.titleUrl}/edit') Edituj 
        | |  
        a(href='#', id='deletePost') Obriši

    p!= post.content
    a(href='#top', class='back-to-top') vrh


- if (session.user)
  != partial('_addComment')
- else
  a(href='/login?returnUrl=' + encodeURIComponent('/post/#{post.titleUrl}#add-comment')) Dodaj komentar



div(class='post-bottom-section', id='comments')  
  h3 Komentari korisnika
  .primary
    ol.commentlist
      - each comment in post.comments
        li(class=comment.cssClass)
          div(id='comment-#{comment._id}')
            .comment-info
              a(href='/user/#{comment._ownerUsername}'): img(src='/images/users/#{comment._ownerUsername}_small.jpg')
              cite
                a(href='/user/#{comment._ownerUsername}')= comment._ownerFullName || comment._ownerUsername
                |  je napisao:
                br
                span.comment-data
                  a(href='/post/#{post.titleUrl}#comment-#{comment._id}')= comment.createdAtFormatted
                  - if (canEditPost || session.user && session.user._id == comment._owner)
                    span(style='padding-left: 20px;')
                      a(href='#', id="#{comment._id}", class='editComment')  Edituj 
                      | | 
                      a(href='#', id='#{comment._id}', class='deleteComment') Obriši
            .comment-text
              != comment.text

script(type='text/javascript')
  $('#deletePost').click(function (e) {
    e.preventDefault();
    confirm('Da li sigurno zelite da obrisete post?')
    ?
    $.ajax({
      url: '/post/#{post._id}/delete',
      type: 'POST',
      data: { 
        '_method': 'DELETE',
        '_csrf': '#{csrfToken}'
      },
      success: function (response) {
        window.location.href = '/post';
      },
      error: function (xhr) {
        console.log(xhr.responseText);
      }
    })
    : false;
  });

script(type='text/javascript')
  $('.deleteComment').click(function (e) {
    e.preventDefault();
    confirm('Da li sigurno zelite da obrisete vas komentar?')
    ?
    $.ajax({
      url: '/post/#{post._id}/comment/' + $(this).attr('id') + '/delete',
      type: 'POST',
      data: { 
        '_method': 'DELETE',
        '_csrf': '#{csrfToken}'
      },
      success: function (response) {
        window.location.href = '/post/#{post.titleUrl}';
      },
      error: function (xhr) {
        console.log(xhr.responseText);
      }
    })
    : false;
  });

script(type='text/javascript')
  $('.editComment').click(function (e) {
    e.preventDefault();
    alert('uskoro....');
  });

  $('#download').toggle(function () {
    $('.download-box').show(200);
  }, function () {
    $('.download-box').hide(200);
  });